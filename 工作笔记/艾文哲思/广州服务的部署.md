## 部署步骤



### 部署服务

***

运行脚本`deploy_tars_server.py`部署全部服务，并手动发布包



### 关闭全部服务

***

到广州机器目录`/root/debug`下执行脚本`start_and_stop.py`,调用函数`close_all_server()`



### 导入数据库

***
1. 导出数据库

   ```shell
   # 机器 10.10.10.168
   cd /root/export_sqls
   # 删除全部的sql文件和txt文件
   rm -rf ./*.sql ./*.txt
   # 导出数据库
   python3 ./export_db.py
   ```

2. 导入数据库

   ```shell
   # step1 ===广州机器的操作
   cd /root/sql_scripts
   # 删除目录下旧文件
   rm -rf ./*.sql ./*.txt
   # step2 
   # 把前面生成的文件copy过来
   
   # step3 == 其它数据库记得设置user,password和host
   python3 ./import_db.py
   ```



### 复制可执行文件

***

```shell
# distribute_prepare.sh 的内容  10.10.10.168
cd /home/package && \
rm -rf ./*  && \
cp -r /usr/local/app/tars/tarsnode/data/XGame.* ./ && \
cp ../copy_tars_server.py ./ && \
tar -zcvf dz_bin.tar.gz ./*
```


```shell
cd /home
source distribute_prepare.sh

# 这里考虑是否需要用sed命令进行替换 
sed -i "s/10.10.10.168/10.10.10.126/g" `grep 10.10.10.168 -rl XGame.*/bin/*`


#把dz_bin.tar.gz 复制到/root/work
tar -zxvf dz_bin.tar.gz

# 用grep "10.10.10.168" XGame.*/bin/* 查找需要替换IP的文件
# 然后用vim打开文件,再用:%s/10.10.10.168/172.17.0.200/g 替换
```



### 重启服务

***

到广州机器目录`/root/debug`下执行脚本`start_and_stop.py`，调用函数`start_all_server()`