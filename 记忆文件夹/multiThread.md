多线程编程注意事项

1. 服务全部状态保存在变量state里面（单例）
2. state里只有一个锁，两个锁很容易出现五个哲学家就餐问题
3. 每个接口处理函数开始前先加锁，完毕解锁
4. 定时器调度时先加锁；定时器调度函数会遍历全部callback
5. 除了接口和定时器调度函数，其它地方不能加锁、解锁
6. 接口函数、定时器函数不能互相调用
7. 业务代码不能使用协程序、多线程



推荐用单线程 + channel的方式编码，多线程非常容易出错