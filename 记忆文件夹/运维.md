# 第一章  部署架构

```ini
;架构一
[负载均衡]
desc = 使用DNS负载均衡

[反向代理]
desc = 外层部署多台nginx反向代理(TCP4层或者ws反向代理等),方便日后带宽扩容

[上游服务]
desc = 全部的上游服务在反向代理后,没有公网IP(没有公网IP会更加安全),和nginx在一个局域网内


;架构二
[单节点部署全部服务]
method-1 = nginx部署在宿主机,上游服务和DB 部署在docker里面,绑定宿主机的127.0.0.1的网卡的端口 [推荐]

method-2 = nginx部署在宿主机,上游服务和DB 部署在宿主机里,但是绑定127.0.0.1的网卡的端口,防火墙只需要对外暴露反向代理的端口
```



# 第二章  常见工作



## 2.1 创建非登录用户

```ini
 [创建]
 cmd = sudo useradd -s /sbin/nologin li
 
 [切换到非登录用户]
 cmd =  sudo su -s /bin/bash li
```



## 2.2 用非登录用户运行服务





## 2.3 内核参数配置

1. 调整进程最大打开文件数

   ```ini
   [查看]
   cmd = ulimit -a
   
   [调整]
   
   ```

   



## 2.4 反向代理配置





## 2.5 静态资源服务器配置



## 2.6 php-fpm配置





## 2.7 Mysql配置



## 2.8 Mongodb配置



## 2.9 防火墙配置





## 2.10 监控配置





## 2.11 上传包到服务器

1. 使用S3 Browser将文件上传到S3，并将ACL设置为All Users 可读
2. 在服务器上用wget下载包



## 2.12 下载包本地

1. 用aws的s3客户端将包上传到s3
2. 从s3下载包到本地





# 第三章 S3

文档地址：https://docs.aws.amazon.com/cli/latest/userguide/cli-services-s3-commands.html

## 3.1 安装

```shell
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
```



## 3.2 配置

```shell
/usr/local/bin/aws configure

#配置项
AWS Access Key ID: AKIAVSFZTWBNFB7EFODG
AWS Secret Access Key: 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
Default region name : sa-east-1
Default output format [None]: json
```



## 3.3 列出桶

```shell
/usr/local/bin/aws s3 ls
```



## 3.4 列出桶里的文件

```shell
/usr/local/bin/aws s3 ls s3://apollo-plan
```



## 3.4 复制文件

类似scp

1. 将s3的文件复制到本地

   ```shell
   /usr/local/bin/aws s3 cp s3://apollo-plan/hk.pem .
   ```

2. 本地文件上传到s3

   ```shell
   /usr/local/bin/aws s3 cp ./code.tar.gz s3://apollo-plan/
   ```

3. 将本地文件上传到s3并且公开地址可以http下载

   ```shell
   /usr/local/bin/aws s3 cp ./code.tar.gz s3://apollo-plan/ --acl public-read
   ```



## 3.5 删除s3中的文件

```shell
aws s3 rm s3://bucket-name/example/filename.txt
```







# 第四章 aws的服务器价格



配置

```ini
内存 = 16G
CPU = 8核心

[硬盘]
;硬盘类型就选择GP2 或者 GP3即可,不要选择其它的
;之前选 预配置IOPS SSD(IO1) 非常贵,一个月几万
类型 = GP3
大小 = 500G
IOPS = 10000
;默认
吞吐量 =125

[价格]
IOPS/天 = 1.94美元
GP3/天  = 2.21美元
;因此想要降低费用,就把内存和CPU降低,因为这边是收费的大部分
EC2/天  = 10.48美元

;算下来一个月费用为439美元,折合人民币3000左右
;开发阶段可以买一个4核心8G内存的,节约成本
```

