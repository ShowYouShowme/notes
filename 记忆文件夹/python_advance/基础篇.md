## 1 Jupyter Notebook

****

1. 安装

   ```shell
   pip3 install jupyter
   ```

2. 启动

   ```shell
   # 默认启动端口是8888
   jupyter notebook
   
   # 指定端口启动
   jupyter notebook --port $portNum
   ```

3. Google Research在线环境

   ```shell
   https://colab.research.google.com/notebooks/basic_features_overview.ipynb
   ```



## 2 元组和列表

***



### 2-1 基础概念

***

1. 都是存放任意数据类型的集合

   ```python
   l = [1, 2 , 'hello', 'world']
   tup = ('jason', 22)
   ```

2. 列表动态(类似c++的vector),元组固定(类似c++的const array)

   ```python
   l = [1, 2, 3, 4]
   l[3] = 40
   
   tup = (1, 2, 3, 4)
   tup[3] = 40  # 此处报错,元组无法修改
   ```

   ```python
   # 增加元素
   tup = (1, 2, 3, 4)
   new_tup = tup + (5,)
   
   l = [1,2,3,4]
   l.append(5)
   ```

3. 基本操作

   + 支持负数索引

     ```python
     l = [1, 2, 3, 4]
     
     tup = (11, 22, 33, 44)
     
     print(l[-1])
     
     print(tup[-2])
     ```

     

   + 支持切片操作

     ```python
     l = [1, 2, 3, 4]
     
     tup = (11, 22, 33, 44)
     
     print(l[0:2])
     
     print(tup[1:3])
     ```

     

   + 列表和元组可以随意嵌套

     ```python
     l = [[1,2,3],[44,55]]
     
     tup = ((7,8,9),(11,203))
     ```

     

   + 列表和元组可以相互转换

     ```python
     # list 转换为tuple
     l = [1, 2, 3]
     t = tuple(l)
     print(t)
     
     # tuple 转换为list
     t1 = (7,8,9)
     l2 = list(t1)
     print(l2)
     ```

     

   + 常用内置函数

     ```python
     l = [3, 2, 3, 7, 8, 1]
     l.count(3) # 返回元素个数
     
     l.index(7) # 返回元素第一次出现的索引
     
     l.reverse() # 颠倒
      
     l.sort() # 排序
      
     tup = (3, 2, 3, 7, 8, 1)
     tup.count(3)
     
     tup.index(7)
     
     # reversed 返回倒转后的列表/元组
     list(reversed(tup))
     
     # sorted 返回倒转后的列表/元组
     sorted(tup)
     [1, 2, 3, 3, 7, 8]
     ```

     





### 2-2 列表和元组存储方式的差异

```python
l = [1,2,3]
print(l.__sizeof__()) # 64

tup = (1,2,3)
print(tup.__sizeof__()) # 48

# 列表需要8个字节存放长度，8个字节存放指针
# tuple 类似c++的array
```

```python
# list 内存分配方式,类似vector
l = []
l.__sizeof__() # 40


l.append(1)
l.__sizeof__() # 72

l.append(2)
l.__sizeof__() # 72

l.append(3)
l.__sizeof__() # 72


l.append(4)
l.__sizeof__() # 72

l.append(5)
l.__sizeof__() # 104
```





### 2-3 列表和元组的性能

+ 元组性能比列表高



### 2-4 使用场景

***

+ 存储的数据数量不变，用元组

  ```python
  def get_location():
      return (longitude, latitude)
  ```

  

+ 存储数据数量可变，用列表

  ```python
  viewer_owner_id_list = [] # 里面的每个元素记录了这个 viewer 一周内看过的所有 owner 的 id
  records = queryDB(viewer_id) # 索引数据库，拿到某个 viewer 一周内的日志
  for record in records:
      viewer_owner_id_list.append(record.id)
  ```





## 3 字典和集合

***

### 3-1 字典和集合的基础

***

+ 集合是`key == value`的字典

+ 字典创建

  ```python
  d1 = {'name' : 'jason', 'age' : 20, 'gender' : 'male'}
  print(d1)
  
  
  d2 = dict({'name' : 'jason', 'age' : 20, 'gender' : 'male'})
  print(d2)
  
  d3 = dict([('name','jason'),('age', 20),('gender','male')])
  print(d3)
  
  d4 = dict(name='jason', age=20, gender='male')
  print(d4)
  
  print(d1 == d2 == d3 == d4)
  ```

+ 集合创建

  ```python
  s1 = {1, 2, 3}
  
  s2 = set([1, 2, 3])
  
  print(s1)
  
  print(s2)
  
  print(s1 == s2)
  ```

+ 字典的访问

  ```python
  d = {'name' : 'jason', 'age' : 20}
  
  print(d['name'])
  print(d.get('age'))
  print(d.get('location', 'null'))
  ```

+ 判断元素是否在集合/字典内

  ```python
  
  # 使用in 操作,非常简洁
  s = {11, 22, 33}
  
  print(11 in s)
  
  print(12 in s)
  
  d = {'name' : 'jason', 'age' : 20}
  
  print('name' in d)
  
  print('location' in d)
  ```

+ 增加，更新和删除

  ```python
  # dict 的增加，更新和删除
  d = {'name': 'jason', 'age': 20}
  d['dob'] = '1999-02-01' # 增加
  
  d['dob'] = '1998-01-01' # 更新
  d.pop('dob') 						# 删除键为'dob'的元素对
  
  # set 的增加和删除
  s = {1, 2, 3}
  s.add(4) 		# 增加4
  print(s)
  s.remove(4) # 删除4
  print(s)
  ```

+ 排序

  + dict排序

    ```python
    d = {'b' : 1, 'a' : 2, 'c' : 10}
    d_sorted_by_key = sorted(d.items(), key = lambda x : x[0])
    d_sorted_by_value = sorted(d.items(), key = lambda x : x[1])
    
    print(d_sorted_by_key)
    
    print(d_sorted_by_value)
    ```

    

  + set排序

    ```python
    s = {3, 4, 1, 2}
    
    sorted(s)
    
    print(s)
    ```

    



### 3-2 字典和集合性能

***

+ 查找`O(1)`
+ 插入`O(1)`



### 3-3 字典和集合工作原理

***

+ 存贮结构

  ```
  类似哈希拉连法
  ```

  

+ 插入操作

  ```shell
  类似哈希表的插入
  ```

  

+ 查找操作

  ```shell
  计算哈希值然后在链表中查找
  ```

  

+ 删除操作

  ```
  赋予特殊值，重新调整哈希表大小再删除
  ```

  

## 4 字符串

***



### 4-1 字符串基础

***

+ 字符串表示

  ```python
  s1 = 'hello'   # 单引号
  s2 = "hello"   # 双引号
  s3 = '''hello''' # 三引号
  s4 = """hello""" # 三引号
  
  print(s1 == s2 == s3 == s4)
  ```

+ 多行注释

  ```python
  def calculate_similarity(item1, item2):
      """
      Calculate similarity between two items
      Args:
          item1: 1st item
          item2: 2nd item
      Returns:
        similarity score between item1 and item2
      """
  ```

+ 转义字符

  | 转义字符 | 说明       |
  | -------- | ---------- |
  | \newline | 接下一行   |
  | \\\      | 表示\      |
  | \\'      | 表示单引号 |
  | \\"      | 表示双引号 |
  | \\n      | 换行       |
  | \\t      | 横向制表符 |
  | \\b      | 退格       |
  | \\v      | 纵向制表符 |
  |          |            |

  



### 4-2  字符串的常用操作

***

+ 索引

  ```python
  name = 'jason'
  
  print(name[0]) # 索引
  ```

  

+ 切片

  ```python
  name = 'jason'
  
  print(name[1:3]) # 切片
  ```

  

+ 遍历

  ```python
  name = 'jason'
  
  for ch in name:
      print(ch)
  ```

+ 不可变

  ```python
  name = 'jason'
  
  name[0] = 'H' # 报错，python的string是const类型的
  ```

+ 字符串拼接

  ```python
  s = ''
  for n in range(5):
      s += str(n)
  print(s)
  ```

  ```python
  
  l = []
  for n in range(5):
      l.append(str(n))
  
  l2 = '_'.join(l) # 把字符串数组的每个元素用'_'连接起来
  print(l2)
  ```

+ 单词切割

  ```python
  words = 'this is a beautiful day'
  l = words.split(' ')
  print(l)
  ```

+ 其它函数

  + string.strip(str)：去掉首位的str字符串
  + string.lstrip(str)：去掉开头的str字符串
  + string.rstrip(str)：去掉尾部的str字符串

### 4-3 字符串的格式化

***

+ 定义：使用一个字符串作为模板，模板中会有格式符。这些格式符为后续真实值预留位置，以呈现出真实值应该呈现的格式

+ 示例

  ```python
  name = 'nash'
  age = 28
  
  print('my name is {}, age {}'.format(name, age)) # 推荐的用法
  print('my name is %s, age %d' %(name, age))
  ```






## 6 条件与循环

***



### 6-1 条件语句

***

```python
y = None
x = 12
if x < 0:
    y = -x
else:
    y = x
print("y = {}".format(y))
```

```python
id = 2
if id == 0:
    print('red')
elif id == 1:
    print('yellow')
else:
    print('green')
```

```python
# 省略判断条件,不推荐的用法
s = '1'
i = 1
b = True

if s:
    print('string is not empty')

if i:
    print('int is not 0')

if b:
    print('bool is true')
```

| 数据类型            | 结果            |
| ------------------- | --------------- |
| String              | 空字符串为False |
| Int                 | 0为False        |
| Bool                | False为False    |
| List/tuple/dict/set | 空为False       |
| Object              | None为False     |
|                     |                 |



### 6-2 循环语句

***

+ 列表的遍历

  ```python
  l = [11, 22, 33, 44]
  
  for item in l:
      print(item)
      
   # 通过下标遍历
  for index in range(0, len(l)):
      if index < 3:
          print(l[index])
  
  print('-' * 10)
  
  # 同时获取下标和元素值
  for index, item in enumerate(l):
      if index < 2:
          print('index : {}, item : {}'.format(index, item))
  ```

  

+ 字典的遍历

  + 遍历键

    ```python
    d = {'name' : 'jason', 'dob' : '2000-01-01', 'gender' : 'male'}
    
    for key in d:  # 遍历字典的键
        print(key)
    ```

    

  + 遍历值

    ```python
    d = {'name' : 'jason', 'dob' : '2000-01-01', 'gender' : 'male'}
    
    for v in d.values():  # 遍历字典的值
        print(v)
    ```

    

  + 遍历键值对

    ```python
    d = {'name' : 'jason', 'dob' : '2000-01-01', 'gender' : 'male'}
    
    for k,v in d.items():  # 遍历字典的键值对
        print('key : {}, value : {}'.format(k,v))
    ```

+ continue：减少嵌套层数

  ```python
  name_price = {'iphone' :  12080, 'mate' : 2469}
  name_color = {'iphone' : ['red', 'green', 'yellow'], 'mate': ['blue', 'grey', 'red']}
  # 价格小于 1000，并且颜色不是红色的所有产品名称和颜色的组合
  for name, price in name_price.items():
      if price < 1000:
          if name in name_color:
              for color in name_color[name]:
                  if color != 'red':
                      print('name : {}, color: {}'.format(name, color))
  
          else:
              print('name: {}, color: {}'.format(name, 'None'))
  ```

  ```python
  # 使用continue减少嵌套层数
  name_price = {'iphone' :  12080, 'mate' : 469}
  name_color = {'iphone' : ['red', 'green', 'yellow'], 'mate': ['blue', 'grey', 'red']}
  # 价格小于 1000，并且颜色不是红色的所有产品名称和颜色的组合
  for name, price in name_price.items():
      if price >= 1000:
          continue
      if name not in name_color:
          print('name: {}, color: {}'.format(name, 'None'))
          continue
      for color in name_color[name]:
          if color == 'red':
              continue
          print('name : {}, color: {}'.format(name, color))
  ```

+ While

  ```python
  while True:
      try:
          text = input('enter your question, enter "q" to quit')
          if text == 'q':
              print('Exit system')
              break
  
          print('text is {}'.format(text))
      except Exception as err:
          print('Encountered error: {}'.format(err))
          break
  ```

  



### 6-3 条件与循环的复用

***

+ 条件与循环组合一

  ```python
  exp1 if condition else exp2 for item in iterable
  ```

  等价于

  ```python
  for item in iterable:
      if condition:
          exp1
      else:
          exp2
  ```

+ 条件与循环组合二

  ```python
  exp for item in iterable if condition
  ```

  等价于

  ```python
  for item in iterable:
      if condition:
          exp1
  ```

+ 例子

  ```python
  l = [11, 22, 33, 44]
  
  a = [item for item in l if item % 2 == 0]
  
  print(a)
  ```

  ```python
  l = [11, 22, 33, 44]
  
  a = [item * 5 if item % 2 ==0 else item * 3 for item in l]
  
  print(a)
  ```

+ 总结

  ```python
  将循环和条件语句组合到一起导致代码难以理解,建议用正常的形式表达。
  ```





## 7 异常处理

***



### 7-1 错误与异常

****

+ 语法错误：不符合python的语法规范，无法被解释执行

+ 异常：可以执行，但执行过程遇到错误

  ```python
  10 / 0
  # ZeroDivisionError: division by zero
  
  order * 2
  # NameError: name 'order' is not defined
  
  1 + [1, 2]
  # TypeError: unsupported operand type(s) for +: 'int' and 'list'
  ```

  

### 7-2 处理异常

***

```python
# input1: a,b
# input2: 1,
try:
    s = input('please input two number separated by comma:')
    num1 = int(s.split(',')[0].strip())
    num2 = int(s.split(',')[1].strip())
    print('n1 : {}, n2 : {}'.format(num1, num2))
except ValueError as err:
    print('value error: {}'.format(err))
except IndexError as err:
    print('Index Error: {}'.format(err))
except Exception as err:
    print('Other error: {}'.format(err))
finally:
    print('this will be execute!')

print('continue')
```



### 7-3 用户自定义异常

***

```python
class MyInputError(Exception):
    def __init__(self, value):
        self.value = value

    def __str__(self):
        return '{} is invalid input'.format(repr(self.value))


try:
    raise MyInputError(1)
except MyInputError as err:
    print('error : {}'.format(err))
```





### 7-4 异常使用的场景和注意点

***

+ 不确定某段代码能成功执行用异常

  ```python
  import json
  
  try:
      s = '{'
      data = json.loads(s)
  except Exception as err:
      print('json decode err : {}'.format(err))
  ```

+ 流程控制的代码逻辑，不使用异常

  ```python
  # 异常的滥用
  d = {'name' : 'jason', 'age' : 20}
  
  try:
      value = d['dob']
      print(value)
  except Exception as err:
      print('KeyError : {}'.format(err))
  ```

  ```python
  # 不使用异常的版本
  d = {'name' : 'jason', 'age' : 20}
  
  if 'dob' in d:
      value = d['dob']
      print(value)
  ```



## 8 函数

***



### 8-1 函数基础

***

+ 函数定义

  ```python
  def my_func(message):
      print('Got a message: {}'.format(message))
  ```

+ 参数默认值

  ```python
  def my_func(message = 'default value'):
      print('Got a message: {}'.format(message))
  ```

+ 声明和调用次序

  + 函数A内调用其它函数，其它函数可以在A函数后定义

    ```python
    def main():
        find_largest_element([8,1,19,2,0])
    
    def find_largest_element(l):
        if not isinstance(l, list):
            print('input is not type of list')
            return
        if len(l) == 0:
            print('empty input')
            return
        largest_element = l[0]
        for item in l:
            if item > largest_element:
                largest_element = item
        print('largest element is : {}'.format(largest_element))
    ```

  + 函数外调用其它函数B，被调用的函数B必须先声明

    ```python
    my_func() # 报错显示函数未定义
    
    # 定义函数
    def my_func(message = 'default value'):
        print('Got a message: {}'.format(message))
    ```

+ 参数类型：python没有类型因此可以传入任何值，需要用户自己写代码进行检查

  ```python
  def main():
      r1 = my_sum(1,2)
      r2 = my_sum([1,2],[3,4])
      print(r1)
      print(r2)
  
  # 可以传入int，list
  def my_sum(a, b):
      return a + b
  ```

+ 函数嵌套

  ```python
  def f1():
      print('hello')
      def f2():
          print('world')
      f2()
  ```

  起到封装的作用

  ```python
  def f1():
      print('hello')
      def f2():
          print('world')
      f2()
      
  def main():
      f2() # 报错,只有f1内部能调用f2
  ```

  提高性能[有点扯淡]

  ```python
  # 函数参数类型检测的模范做法
  def factorial(input):
      if not isinstance(input, int):
          raise Exception('input must be an integer.')
      if input < 0:
          raise Exception('input must be greater or equal to 0')
  
      def inner_factorial(input):
          if input <= 1:
              return 1
          return input * inner_factorial(input - 1)
      return inner_factorial(input)
  ```

  



### 8-2 函数变量作用域

***

1. 局部变量：类似c++

2. 全局变量

   ```python
   MAX_VALUE = 128
   def main():
   
       MAX_VALUE = 5 # 与全局变量同名,覆盖全局变量,该语句可以认为是变量定义语句
       print(MAX_VALUE)
       get_global()
   
   def get_global():
       print(MAX_VALUE)
   ```

   ```python
   MAX_VALUE = 128
   def main():
   
       global  MAX_VALUE # 声明变量为全局变量
       MAX_VALUE = 5
       print(MAX_VALUE)
       get_global()
   
   def get_global():
       # 只读全局变量,可以不用global 先声明
       print(MAX_VALUE)
   ```

   ```sh
   建议：全局变量已'g_'开头，避免和局部变量同名；函数内部访问全局变量，显示使用global 先声明
   ```

3. 函数内部嵌套函数

   ```python
   def outer():
       x = 'local'
       def inner():
           nonlocal x # 类似global
           x = 'nonlocal'
           print(x)
       inner()
       print('outer: {}'.format(x))
   ```

   



### 8-3 闭包

***

+ 示例

  ```python
  def main():
      square = nth_power(2)
      cube = nth_power(3)
      print(square(10))
      print(cube(3))
  
  # 带有状态的函数
  def nth_power(exponent):
      def exponent_of(base):
          nonlocal exponent
          return base ** exponent
      return exponent_of
  ```

  